<div class="container-sm">
  <h1 class='mb-3'>
    <%= link_to 'Package Usage', usage_index_path %>:
    <%= link_to @package_usage.ecosystem, ecosystem_usage_path(@package_usage.ecosystem) %>:
    <%= @package_usage.name %>
  </h1>

  <% if @package_usage.package %>
    <p>
      <small class='text-muted'>
        <%= @package_usage.package['description'] %>

        <% if @package_usage.package['versions_count'] %>
          <br/><%= pluralize number_with_delimiter(@package_usage.package['versions_count']), 'version' %>
        <% end %>

        <% if @package_usage.package['latest_release_published_at'] %>
          <br/><span title="<%= @package_usage.package['latest_release_published_at'] %>">Latest release: <%= time_ago_in_words @package_usage.package['latest_release_published_at'] %> ago</span>
        <% end %>

        <% if @package_usage.package['dependent_packages_count'] && @package_usage.package['dependent_packages_count'] > 0 %>
          <br/><%= pluralize number_with_delimiter(@package_usage.package['dependent_packages_count']), 'dependent package' %>
        <% end %>

        <% if @package_usage.package['downloads'] %>
          <br/><%= number_with_delimiter(@package_usage.package['downloads']) %> downloads <%= download_period(@package_usage.package['downloads_period']) %>
        <% end %>
      </small>
    </p>

    <% if @package_usage.registry %>
      <p>
        View more package details: <%= link_to @package_usage.packages_html_url, @package_usage.packages_html_url, target: :_blank %>
      </p>
    <% end%>

    <% if @package_usage.repository %>
      <p>
        View more repository details: <%= link_to host_repository_url(@package_usage.host, @package_usage.repository), host_repository_path(@package_usage.host, @package_usage.repository) %>
      </p>
    <% end%>
  <% end %>

  <h3>Requirements</h3>
  <% max_rows = 20 %>
  <% rows = [@package_usage.requirements.length, max_rows].min %>
  <%= bar_chart sort_by_semver_range(@package_usage.requirements, max_rows), height: "#{(rows*30)+50}px" %>

  <div class='row my-3'>
    <div class='col'>
      <h3>Kind</h3>
      <%= pie_chart @package_usage.kind, legend: "left", width: '50%'  %>
    </div>
    <div class='col'>
      <h3>Direct</h3>
      <%= pie_chart @package_usage.direct, legend: "left", width: '50%' %>
    </div>
  </div>

  <h3>Dependent Repos <small class='text-muted'><%= number_with_delimiter @package_usage.dependents_count %></small></h3>
  <%= render @repositories %>
  <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>  
</div>


